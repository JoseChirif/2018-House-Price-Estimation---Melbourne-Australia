name: Sync to Hugging Face Space

on:
  push:
    branches: [main]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Prepare clean export for HF (no large files)
        run: |
          set -e
          mkdir -p /tmp/hf_export

          # Copy ONLY what the Space needs
          cp -f Dockerfile /tmp/hf_export/ || true
          cp -f app.py /tmp/hf_export/ || true
          cp -f requirements.txt /tmp/hf_export/ || true
          cp -f README.md /tmp/hf_export/ || true

          # Your dashboard code
          cp -R Dashboard /tmp/hf_export/Dashboard

          # Optional: license
          cp -f LICENSE.txt /tmp/hf_export/ || true

          # Safety: remove notebooks if any slipped in
          find /tmp/hf_export -name "*.ipynb" -delete || true

      - name: Push export to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          set -e
          cd /tmp/hf_export

          git init
          git config user.email "action@github.com"
          git config user.name "GitHub Action"

          git add -A
          git commit -m "Sync from GitHub"

          git branch -M main
          git remote add hf https://user:${HF_TOKEN}@huggingface.co/spaces/JoseCh/2018-House-Price-Estimation-Melbourne-Australia
          git push --force hf main
